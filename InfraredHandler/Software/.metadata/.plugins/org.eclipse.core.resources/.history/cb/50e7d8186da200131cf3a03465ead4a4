/*
 * InfraredHandler.h
 *
 *  Created on: 2014-02-28
 *      Author: Kenan Kigunda
 */

#ifndef INFRAREDHANDLER_H_
#define INFRAREDHANDLER_H_

#include "altera_avalon_pio_regs.h"
#include "altera_up_avalon_de0_nano_adc.h"
#include "includes.h"

#include "DataSource.h"
#include "Status.h"

#define INFRARED_HANDLER_UPDATE_TIME_MILLIS	50

#define INFRARED_HANDLER_EMITTTER_ON		1
#define INFRARED_HANDLER_EMITTER_OFF		0

class InfraredHandler: public DataSource {
public:
	InfraredHandler();
	virtual ~InfraredHandler();

	/*
	 * Initializes this handler.
	 * @return OK if there are no initialization errors
	 */
	Status init();

	/*
	 * Updates this handler.
	 * @return OK if the infrared readings are valid and have been posted to all listeners without error
	 */
	Status update();

	/**
	 * Sends a signal from the infrared emitters.
	 */
	void send();

private:
	alt_up_de0_nano_adc_dev *adc_dev;

	unsigned int read(int channel);
	Status onInfraredReceive(unsigned int level);
};

//#define INFRAREDHANDLER_DEBUG

//#define INFRAREDHANDLER_SEND_DEBUG
#if defined(INFRAREDHANDLER_SEND_DEBUG) || defined(INFRAREDHANDLER_DEBUG) || defined(DEBUG)
#define INFRAREDHANDLER_SEND_LOG(info) info
#else
#define INFRAREDHANDLER_SEND_LOG(info)
#endif

//#define INFRAREDHANDLER_RECEIVE_DEBUG
#if defined(INFRAREDHANDLER_RECEIVE_DEBUG) || defined(INFRAREDHANDLER_DEBUG) || defined(DEBUG)
#define INFRAREDHANDLER_SEND_LOG(info) info
#else
#define INFRAREDHANDLER_SEND_LOG(info)
#endif

#endif /* INFRAREDHANDLER_H_ */
