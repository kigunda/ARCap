/*
 * InfraredSender.cpp
 *
 *  Created on: 2014-03-23
 *      Author: kigunda
 */

#include "InfraredSender.h"

#define INFRARED_SENDER_ON_TIME_SECONDS		1
#define INFRARED_SENDER_OFF_TIME_SECONDS	1

#define INFRARED_SENDER_ON		1
#define INFRARED_SENDER_OFF		0

// TASKS

extern InfraredSender *infraredSender;

/* @test Periodically sends an infrared signal. */
void infrared_handler_send_test_task(void *pdata) {
	printf("InfraredHandler [task: send test, status: start]\n");
	while (true) {
		infrared->send();
		OSTimeDlyHMSM(0, 0, INFRARED_SENDER_OFF_TIME_SECONDS, 0);
	}
}

// SENDING

/**
 * Sends a signal from the infrared emitters.
 * @return OK if the signal was sent successfully
 */
void InfraredSender::send() {
	IOWR_ALTERA_AVALON_PIO_DATA(PIO_IR_EMITTER_BASE, INFRARED_SENDER_ON);
	INFRAREDHANDLER_SEND_LOG(printf("InfraredHandler [emitter: on]\n"));
	OSTimeDlyHMSM(0, 0, INFRARED_SENDER_ON_TIME_SECONDS, 0);
	IOWR_ALTERA_AVALON_PIO_DATA(PIO_IR_EMITTER_BASE, INFRARED_SENDER_OFF);
	INFRAREDHANDLER_SEND_LOG(printf("InfraredHandler [emitter: off]\n"));
}

