/*
 * InfraredReceiver.cpp
 *
 *  Created on: 2014-03-23
 *      Author: kigunda
 */

#include "InfraredReceiver.h"

InfraredReceiver::InfraredReceiver() {
	// TODO Auto-generated constructor stub

}

InfraredReceiver::~InfraredReceiver() {
	// TODO Auto-generated destructor stub
}

/*
 * Reads the level of the given receive channel.
 * @param channel - the number of the ADC channel to read
 * @return the 12-bit level read from the channel, indicating the amount of infrared light
 * hitting the receivers
 * */
unsigned int InfraredReceiver::read(int channel) {
	alt_up_de0_nano_adc_update(adc_dev);
	unsigned int level = (alt_up_de0_nano_adc_read(adc_dev, channel) >> INFRARED_HANDLER_ADC_READ_UNUSED) - INFRARED_HANDLER_ADC_READ_BASE;
	INFRAREDHANDLER_RECEIVE_LOG(printf("InfraredHandler [channel: %d, level: %u]\n", channel, level));
	return level;
}

/*
 * Posts the given infrared level readings to the listener.
 * @param level - the level read by the infrared receivers
 * @throw PostException is the reading cannot be posted to the listener
 */
void InfraredReceiver::post(unsigned int level) {
	INT8U status;
	status = OSQPost(listener, (void *)level);
	if (status != OS_NO_ERR) {
		throw new PostException();
	}
}
