/*
 * NetworkInfraredBridge.h
 *
 *  Created on: 2014-03-03
 *      Author: Kenan Kigunda
 */

#ifndef NETWORKINFRAREDBRIDGE_H_
#define NETWORKINFRAREDBRIDGE_H_

#include "includes.h"

#include "Debug.h"
#include "InfraredHandler.h"
#include "NetworkCommand.h"
#include "Status.h"

#define NETWORK_TO_INFRARED_RECEIVE_SIZE 4

/*
 * The network-to-infrared bridge listens
 */
class NetworkInfraredBridge {
public:
	/*
	 * Creates a new network-to-infrared bridge.
	 * @param target - the infrared handler to which this bridge will forward network events
	 */
	NetworkInfraredBridge(InfraredHandler *target);
	virtual ~NetworkInfraredBridge();

	/*
	 * Initializes this bridge.
	 * @return OK if there are no initialization errors
	 */
	Status init();

	/*
	 * Checks the network receive queue for infrared commands.
	 * @return OK when a new command is received and processed without error
	 */
	Status update();

	/*
	 * Gets the queue used to accept network events.
	 * @return the network receive queue
	 */
	OS_EVENT *listener();

private:
	/* The buffer and queue used to receive network events. */
	int receiveBuffer[NETWORK_TO_INFRARED_RECEIVE_SIZE];
	OS_EVENT *receiveQueue;

	/* The infrared handler to which network events will be forwarded. */
	InfraredHandler *infrared;

	/*
	 * Processes a network command. The command will be accepted if it is an infrared command.
	 * @param command - the command to process
	 * @return OK if the command was accepted and forwarded
	 * @return ERR_BRIDGE_MESSAGE_NOT_ACCEPTED if the command was not accepted
	 */
	Status process(NetworkCommand command);
};

#if defined(NETWORKINFRAREDBRIDGE_DEBUG) || defined(DEBUG)
#define NETWORKINFRAREDBRIDGE_LOG(info) info
#else
#define NETWORKINFRAREDBRIDGE_LOG(info)
#endif

#endif /* NETWORKINFRAREDBRIDGE_H_ */
