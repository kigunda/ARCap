/*
 * CommandHandler.cpp
 *
 *  Created on: 2014-03-01
 *      Author: Kenan Kigunda
 */

#include <stdio.h>
#include "CommandHandler.h"

// ALLOCATION
InfraredToNetwork::InfraredToNetwork() {}
InfraredToNetwork::~InfraredToNetwork() {}

// INITIALIZATION

/*
 * Initializes this handler.
 * @return OK if there are no initialization errors
 */
Status InfraredToNetwork::init() {
	return createInfraredReceive();
}

// INFRARED

Status InfraredToNetwork::createInfraredReceive() {
	/* Create the infrared receive queue. */
	infraredReceiveQueue = OSQCreate((void**)&infraredReceiveArray, COMMAND_INFRARED_RECEIVE_SIZE);
	if (infraredReceiveQueue == NULL) {
		return ERR_INFRARED;
	} else {
		return OK;
	}
}

/*
 * Gets the queue used to accept infrared receive events.
 * @return the infrared receive queue
 */
OS_EVENT *InfraredToNetwork::onInfraredReceive() {
	return infraredReceiveQueue;
}

/*
 * Checks the infrared receive queue for new readings.
 * @return OK when a new reading is received and processed without error
 */
Status InfraredToNetwork::checkInfraredReceive() {
	INT8U status;
	int level = (int)OSQPend(infraredReceiveQueue, 0, &status);
	if (status != OS_NO_ERR) {
		return ERR_INFRARED;
	} else {
		return processInfraredReceive(level);
	}
}

/*
 * Processes an infrared receive event.
 * @param level - the level recorded by the infrared receiver
 */
Status InfraredToNetwork::processInfraredReceive(unsigned int level) {
	if (level > COMMAND_INFRARED_RECEIVE_THRESHHOLD) {
		printf("CommandHandler [event: infrared receive, level: %u]\n", level);
	} return OK;
}
