function Connection(controller) {
	this.controller = controller;
//	this.uri = 'ws://127.0.0.1:10000/arcap/player';
	this.uri = 'ws://192.168.0.100:10000/arcap/player';
	this.websocket = new WebSocket(this.uri);
	this.id = $('#player-id').text();
	this.connected = false;
	var connection = this;
	
	this.websocket.onopen = function(e) {
		console.log('[WebSocket] Connected');
		// Send player details.
		connection.websocket.send('+p' + connection.id);
		// Send a test shot.
		connection.websocket.send('is');
	};

	this.websocket.onmessage = function(e) {
		// Ignore the final newline.
		var message = e.data.substring(0, e.data.length - 1);
		console.log('[WebSocket] ' + message);
		// Check message.
		switch (message) {
		case ':ok':
			connection.controller.ready(true);
			break;
		case ':err':
			connection.controller.ready(false);
			break;
		case 'ih ' + connection.id:
			connection.controller.hit();
			break;
		}
	};
	
	this.websocket.onerror = function(e) {
		console.log('[WebSocket] error: ' + e.data);
	};
	
	this.websocket.onclose = function(e) {
		console.log('[WebSocket] disconnected');
	};
}

Connection.prototype.send = function(message) {
	if (!this.controller.ready) return false;
	this.websocket.send(message + '\n');
	console.log('[WebSocket] ' + message);
	return true;
};